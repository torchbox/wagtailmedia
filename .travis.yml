version: ~> 1.0
os: linux
dist: bionic
language: python
cache:
  pip: true
  directories:
    - .tox

jobs:
  # See https://docs.wagtail.io/en/latest/releases/upgrading.html
  include:
    # Latest Python, latest Django, latest Wagtail.
    - env: TOXENV=py39-dj31-wag211
      python: 3.9
      install:
        - pip install tox==3.9.0 flake8 isort
      script:
        - flake8 wagtailmedia
        - isort --check-only --diff wagtailmedia
        - tox
    # Latest Python, latest Django, all other supported Wagtail.
    - env: TOXENV=py39-dj31-wag210
      python: 3.9
    # All Python versions with Django & Wagtail LTS.
    - env: TOXENV=py39-dj22-wag27
      python: 3.9
    - env: TOXENV=py38-dj22-wag27
      python: 3.8
    - env: TOXENV=py37-dj22-wag27
      python: 3.7
    - env: TOXENV=py36-dj22-wag27
      python: 3.6

install:
  - pip install tox==3.9.0

script:
  - tox

after_success:
  - bash <(curl -s https://codecov.io/bash)
